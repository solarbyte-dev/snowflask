<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>â„ï¸ snow.flask - File Server</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header>
  <h1>â„ï¸ snow.flask</h1>
  <h3>local file server</h3>
</header>

<main>
  <div class="instructions">
    <p>ğŸ“‚ To <strong>upload</strong> files, just drag and drop them into the <code>/Uploads</code> folder located in the project directory.</p>
    <p>Refresh this page to see the updated file list.</p>
  </div>

  <h2>ğŸ“ Files:</h2>
  <div class="file-tree">

    {# Recursive macro to render folder structure #}
    {% macro render_folder(folder) %}
      <details open>
        <summary class="folder-name">ğŸ“ {{ folder.name.split('/')[-1] if folder.name else '/' }}</summary>
        <ul>
          {# Render files with emojis #}
          {% for file in folder.files %}
            {% set ext = file.split('.')[-1].lower() %}
            <li class="file-entry">
              {% if ext in ['png', 'jpeg', 'jpg'] %}
                ğŸ–¼ï¸
              {% elif ext in ['mp4', 'mkv', 'webm'] %}
                ğŸ¥
              {% elif ext in ['txt', 'md', 'c', 'cpp', 'py'] %}
                ğŸ“„
              {% else %}
                âš™ï¸
              {% endif %}
              <a href="{{ url_for('download_file', filename=(folder.name + '/' + file).lstrip('/')) }}">{{ file }}</a>
            </li>
          {% endfor %}

          {# Recursive render subfolders #}
          {% for subfolder in folder.subfolders %}
            <li>
              {{ render_folder(subfolder) }}
            </li>
          {% endfor %}
        </ul>
      </details>
    {% endmacro %}

    {% for folder in structure %}
      {{ render_folder(folder) }}
    {% endfor %}
  </div>
</main>

<footer>
  â„ï¸ snow.flask running on your LAN
</footer>

</body>
</html>
